# 消防设施管理系统 - 项目说明文档

## 📋 项目概述

消防设施管理系统是一个基于 Spring Boot + Vue 3 + MySQL 的现代化消防设施管理平台。系统旨在解决消防救援支队在消防设施数据管理中面临的底数不清、状态更新滞后、现场查询手段缺乏等问题。

### 🎯 项目目标

- **数字化管理**：实现消防设施的数字化采集、存储和管理
- **实时化查询**：支持消防战士现场快速查询周边设施信息
- **标准化流程**：建立完整的数据采集、审核、管理流程
- **可视化分析**：提供统计分析和数据看板功能

## 🏗️ 系统架构

### 整体架构
```
┌─────────────────────────────────────────────────────────────┐
│                        后端服务层                            │
├─────────────────────────────────────────────────────────────┤
│  认证服务 │ 设施管理 │ 审核服务 │ 统计服务 │ 文件服务        │
└─────────────────────────────────────────────────────────────┘
                              ↕ RESTful API
┌─────────────────────────────────────────────────────────────┐
│                       终端应用层                             │
├─────────────────────────────────────────────────────────────┤
│                    Web管理端 (Vue 3 + Vite)                  │
└─────────────────────────────────────────────────────────────┘
```

### 技术栈

**后端技术栈**
- **框架**: Spring Boot 2.7.18
- **数据库**: MySQL 8.0 + MyBatis Plus
- **安全**: Spring Security + JWT
- **文件存储**: 本地存储

**前端技术栈**
- **Web管理端**: Vue 3 + Vite + Element Plus + ECharts
- **地图**: Leaflet + 高德地图 SDK
- **测试**: Vitest + Fast-check

**开发工具**
- **构建工具**: Maven (后端) + Vite (前端)
- **代码质量**: ESLint + Prettier
- **版本控制**: Git

## 📁 项目结构

```
fire-management-system/
├── backend/                     # 后端服务 (Spring Boot)
│   ├── src/main/java/          # Java 源码
│   │   └── com/fire/management/
│   │       ├── controller/     # 控制器层 (8个控制器)
│   │       │   ├── AuthController.java      # 认证接口
│   │       │   ├── UserController.java      # 用户管理
│   │       │   ├── FacilityController.java  # 设施管理
│   │       │   ├── AuditController.java     # 审核管理
│   │       │   ├── StatisticsController.java # 统计分析
│   │       │   ├── FileController.java      # 文件上传
│   │       │   ├── NavigationController.java # 导航服务
│   │       │   └── DeduplicationController.java # 去重服务
│   │       ├── service/        # 业务逻辑层
│   │       ├── entity/         # 实体类
│   │       ├── dto/            # 数据传输对象
│   │       ├── vo/             # 视图对象
│   │       ├── mapper/         # MyBatis 映射接口
│   │       ├── config/         # 配置类
│   │       ├── security/       # 安全相关
│   │       ├── filter/         # 过滤器 (XSS防护)
│   │       ├── interceptor/    # 拦截器 (权限校验)
│   │       ├── utils/          # 工具类
│   │       ├── common/         # 公共类
│   │       ├── annotation/     # 自定义注解
│   │       └── exception/      # 异常处理
│   ├── src/main/resources/    # 配置文件
│   │   ├── application.yml    # 主配置文件 (端口: 9090)
│   │   └── sql/               # SQL脚本
│   ├── pom.xml               # Maven 配置
│   ├── DATABASE.md           # 数据库设计文档
│   ├── SECURITY.md           # 安全配置说明
│   └── PERFORMANCE.md        # 性能优化建议
├── web-admin/                # Web 管理端 (Vue 3)
│   ├── src/
│   │   ├── views/           # 页面组件
│   │   │   ├── Login.vue        # 登录页
│   │   │   ├── Layout.vue       # 布局组件
│   │   │   ├── Dashboard.vue    # 数据看板
│   │   │   ├── Facilities.vue   # 设施管理
│   │   │   ├── Map.vue          # 地图展示
│   │   │   ├── Users.vue        # 用户管理
│   │   │   ├── Audit.vue        # 审核管理
│   │   │   └── DataCollection.vue # 数据采集
│   │   ├── utils/          # 工具函数
│   │   │   └── request.js      # Axios 封装
│   │   ├── router/         # 路由配置
│   │   ├── App.vue         # 根组件
│   │   └── main.js         # 入口文件
│   ├── dist/               # 构建输出目录
│   ├── package.json        # 依赖配置
│   ├── vite.config.js      # Vite 配置
│   ├── vitest.config.js    # 测试配置
│   ├── MAP_SETUP.md        # 地图配置指南
│   └── MAP_TROUBLESHOOTING.md # 地图问题排查
├── docx/                    # 文档目录
│   ├── README.md           # 项目简介
│   ├── 开发指南.md         # 开发文档
│   ├── 部署指南.md         # 部署文档
│   └── 软件设计说明书.md   # 详细设计文档
├── pack.bat                # 打包脚本
└── 项目说明文档.md         # 本文档
```

## 🚀 核心功能

### 1. 用户管理与权限控制
- **多角色支持**: 系统管理员、数据采集员、数据审核员、消防战士
- **权限管控**: 基于 RBAC 模型的细粒度权限控制
- **安全认证**: JWT Token + 密码加密存储
- **XSS防护**: 内置 XSS 过滤器

### 2. 消防设施管理
- **设施信息**: 消防栓位置、状态、工作压力、照片等
- **数据采集**: 支持现场采集，GPS 定位
- **状态管理**: 正常、损坏、待检查等状态跟踪
- **照片管理**: 多角度照片上传与管理

### 3. 地图可视化
- **地图展示**: 基于 Leaflet + 高德地图的交互式地图
- **设施标注**: 不同状态用不同颜色标识
- **周边查询**: 根据位置查询周边消防设施
- **导航功能**: 集成导航到指定设施

### 4. 数据审核与去重
- **审核流程**: 采集数据需经过审核才能正式入库
- **智能去重**: 基于地理位置的自动去重算法
- **审核记录**: 完整的审核历史记录

### 5. 统计分析
- **数据看板**: 实时统计各类指标
- **可视化图表**: 柱状图、饼图等
- **报表导出**: 支持数据导出

## 👥 用户角色

| 角色 | 权限代码 | 功能 |
|------|----------|------|
| 系统管理员 | user:manage, facility:manage, facility:view, audit:manage, stats:view, system:config | 全系统管理 |
| 数据采集员 | facility:collect, facility:view | 现场采集消防设施信息 |
| 数据审核员 | audit:manage, facility:view | 审核采集数据的准确性 |
| 消防战士 | facility:view, facility:navigate | 查询周边消防设施、导航 |

### 默认账号

| 用户名 | 密码 | 角色 |
|--------|------|------|
| admin | 123456 | 系统管理员 |
| collector01 | 123456 | 数据采集员 |
| auditor01 | 123456 | 数据审核员 |

## 🔧 环境要求

### 开发环境
- **JDK**: 11+
- **Maven**: 3.6+
- **MySQL**: 8.0+
- **Node.js**: 16+

### 端口配置
- **后端服务**: 9090
- **前端开发**: 3000 (vite dev)
- **MySQL**: 3306

## 📦 快速开始

### 1. 数据库初始化
```bash
# 创建数据库
mysql -u root -p -e "CREATE DATABASE fire_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 执行初始化脚本
mysql -u root -p --default-character-set=utf8mb4 fire_management < backend/src/main/resources/sql/fire_management_full.sql
```

### 2. 启动后端
```bash
cd backend
# 修改 src/main/resources/application.yml 中的数据库密码
mvn clean install
mvn spring-boot:run
```
后端服务：http://localhost:9090

### 3. 启动前端
```bash
cd web-admin
npm install
npm run dev
```
Web 管理端：http://localhost:3000

### 4. 打包部署
```bash
# 使用打包脚本
pack.bat
```

## 🔒 安全特性

- **传输加密**: 支持 HTTPS/TLS 协议
- **存储加密**: 密码加盐哈希存储
- **访问控制**: 基于角色的权限控制
- **XSS防护**: 内置 XSS 过滤器
- **日志审计**: 完整的操作日志记录

## 📊 API 接口

### 认证接口
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出

### 设施管理
- `GET /api/facilities` - 设施列表
- `GET /api/facilities/{id}` - 设施详情
- `POST /api/facilities` - 新增设施
- `PUT /api/facilities/{id}` - 更新设施
- `DELETE /api/facilities/{id}` - 删除设施
- `GET /api/facilities/nearby` - 周边设施查询

### 用户管理
- `GET /api/users` - 用户列表
- `POST /api/users` - 新增用户
- `PUT /api/users/{id}` - 更新用户
- `DELETE /api/users/{id}` - 删除用户

### 审核管理
- `GET /api/audit/records` - 审核记录列表
- `POST /api/audit/approve/{id}` - 审核通过
- `POST /api/audit/reject/{id}` - 审核拒绝

### 统计分析
- `GET /api/statistics/overview` - 统计概览
- `GET /api/statistics/trend` - 趋势分析

## 🐛 常见问题

### 1. 403 权限错误
清除浏览器缓存并重新登录，或检查用户权限配置。

### 2. 数据库连接失败
检查 `application.yml` 中的数据库连接信息是否正确。

### 3. 地图不显示
检查高德地图 API Key 配置，详见 `web-admin/MAP_SETUP.md`。

### 4. 前端启动失败
```bash
rm -rf node_modules package-lock.json
npm install
```

## 📚 相关文档

- **开发指南**: [docx/开发指南.md](docx/开发指南.md)
- **部署指南**: [docx/部署指南.md](docx/部署指南.md)
- **数据库文档**: [backend/DATABASE.md](backend/DATABASE.md)
- **安全配置**: [backend/SECURITY.md](backend/SECURITY.md)
- **性能优化**: [backend/PERFORMANCE.md](backend/PERFORMANCE.md)
- **地图配置**: [web-admin/MAP_SETUP.md](web-admin/MAP_SETUP.md)

---

**最后更新**: 2024年12月16日  
**文档版本**: v1.1.0  
**项目版本**: v1.0.0
