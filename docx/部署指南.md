# éƒ¨ç½²æŒ‡å—

## ğŸ“¦ æ‰“åŒ…

### æ–¹æ³•1ï¼šä½¿ç”¨æ‰“åŒ…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# æ‰“åŒ…éƒ¨ç½²ç‰ˆæœ¬ï¼ˆJAR + å‰ç«¯ + SQL + æ–‡æ¡£ï¼‰
build-release.bat

# æ‰“åŒ…æºä»£ç ï¼ˆæ’é™¤ node_modules, target ç­‰ï¼‰
create-source-zip.bat
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰“åŒ…

**åç«¯æ‰“åŒ…ï¼š**
```bash
cd backend
mvn clean package -DskipTests
# ç”Ÿæˆï¼štarget/fire-management-system-1.0.0.jar
```

**å‰ç«¯æ‰“åŒ…ï¼š**
```bash
cd web-admin
npm run build
# ç”Ÿæˆï¼šdist/ ç›®å½•
```

## ğŸš€ éƒ¨ç½²åˆ°æœåŠ¡å™¨

### 1. æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£… JDK 11
sudo apt install openjdk-11-jdk

# å®‰è£… MySQL 8.0
sudo apt install mysql-server

# å®‰è£… Nginx
sudo apt install nginx

# å®‰è£… Redisï¼ˆå¯é€‰ï¼‰
sudo apt install redis-server
```

### 2. æ•°æ®åº“åˆå§‹åŒ–

```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE fire_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
mysql -u root -p --default-character-set=utf8mb4 fire_management < INIT_ALL.sql
```

### 3. éƒ¨ç½²åç«¯

```bash
# ä¸Šä¼  JAR åŒ…åˆ°æœåŠ¡å™¨
scp fire-management-system-1.0.0.jar user@server:/opt/fire-management/

# ä¿®æ”¹é…ç½®æ–‡ä»¶
vim application.yml
# ä¿®æ”¹æ•°æ®åº“è¿æ¥ã€Redis é…ç½®ç­‰

# å¯åŠ¨æœåŠ¡
nohup java -jar fire-management-system-1.0.0.jar > app.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f app.log
```

### 4. éƒ¨ç½²å‰ç«¯

**æ–¹æ³•1ï¼šä½¿ç”¨ Nginxï¼ˆæ¨èï¼‰**

```bash
# ä¸Šä¼ å‰ç«¯æ–‡ä»¶
scp -r dist/* user@server:/var/www/fire-management/

# é…ç½® Nginx
sudo vim /etc/nginx/sites-available/fire-management
```

Nginx é…ç½®ç¤ºä¾‹ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/fire-management;
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /files/ {
        alias /opt/fire-management/uploads/;
    }
}
```

```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/fire-management /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

**æ–¹æ³•2ï¼šåç«¯ç›´æ¥æä¾›é™æ€æ–‡ä»¶**

å°†å‰ç«¯ dist ç›®å½•æ”¾åˆ°åç«¯ resources/static ä¸‹ï¼Œç›´æ¥è®¿é—® http://server:8080

### 5. é…ç½® HTTPSï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

### application.yml é…ç½®

```yaml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/fire_management?useSSL=true
    username: fire_user
    password: strong_password_here
    
  redis:
    host: localhost
    port: 6379
    password: redis_password_here
    
jwt:
  secret: your_production_jwt_secret_key_here  # å¿…é¡»ä¿®æ”¹ï¼
  expiration: 86400000  # 24å°æ—¶

file:
  upload-path: /opt/fire-management/uploads/
  access-url: https://your-domain.com/files/

logging:
  level:
    root: INFO
    com.fire.management: INFO
  file:
    name: /opt/fire-management/logs/app.log
```

### å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   ```sql
   -- ä¿®æ”¹ admin å¯†ç 
   UPDATE sys_user SET password = 'æ–°å¯†ç çš„MD5' WHERE username = 'admin';
   ```

2. **ä¿®æ”¹ JWT å¯†é’¥**
   - åœ¨ application.yml ä¸­è®¾ç½®å¼ºå¯†é’¥
   - è‡³å°‘ 32 ä½éšæœºå­—ç¬¦

3. **é…ç½®é˜²ç«å¢™**
   ```bash
   # åªå¼€æ”¾å¿…è¦ç«¯å£
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw enable
   ```

4. **æ•°æ®åº“å®‰å…¨**
   ```sql
   -- åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
   CREATE USER 'fire_user'@'localhost' IDENTIFIED BY 'strong_password';
   GRANT ALL PRIVILEGES ON fire_management.* TO 'fire_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

## ğŸ”„ æœåŠ¡ç®¡ç†

### ä½¿ç”¨ systemd ç®¡ç†åç«¯æœåŠ¡

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo vim /etc/systemd/system/fire-management.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=Fire Management System
After=network.target mysql.service

[Service]
Type=simple
User=fire
WorkingDirectory=/opt/fire-management
ExecStart=/usr/bin/java -jar /opt/fire-management/fire-management-system-1.0.0.jar
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

ç®¡ç†å‘½ä»¤ï¼š

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start fire-management

# åœæ­¢æœåŠ¡
sudo systemctl stop fire-management

# é‡å¯æœåŠ¡
sudo systemctl restart fire-management

# å¼€æœºè‡ªå¯
sudo systemctl enable fire-management

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status fire-management

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u fire-management -f
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /opt/fire-management/logs/app.log

# æŸ¥çœ‹ Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/fire-management
```

### æ•°æ®åº“å¤‡ä»½

```bash
# æ¯æ—¥å¤‡ä»½è„šæœ¬
#!/bin/bash
DATE=$(date +%Y%m%d)
mysqldump -u root -p fire_management > /backup/fire_management_$DATE.sql
find /backup -name "fire_management_*.sql" -mtime +7 -delete

# æ·»åŠ åˆ° crontab
crontab -e
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /opt/scripts/backup.sh
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹ Java è¿›ç¨‹
jps -l

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
jstat -gc <pid>

# æŸ¥çœ‹çº¿ç¨‹
jstack <pid>

# æŸ¥çœ‹ MySQL æ€§èƒ½
mysql -u root -p -e "SHOW FULL PROCESSLIST;"
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### åç«¯æ›´æ–°

```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp fire-management-system-1.0.0.jar fire-management-system-1.0.0.jar.bak

# 2. åœæ­¢æœåŠ¡
sudo systemctl stop fire-management

# 3. ä¸Šä¼ æ–°ç‰ˆæœ¬
scp fire-management-system-1.0.1.jar user@server:/opt/fire-management/

# 4. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
mysql -u root -p fire_management < migration.sql

# 5. å¯åŠ¨æœåŠ¡
sudo systemctl start fire-management

# 6. éªŒè¯
curl http://localhost:8080/api/health
```

### å‰ç«¯æ›´æ–°

```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
sudo cp -r /var/www/fire-management /var/www/fire-management.bak

# 2. ä¸Šä¼ æ–°ç‰ˆæœ¬
scp -r dist/* user@server:/var/www/fire-management/

# 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# ç”¨æˆ·éœ€è¦å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl + F5ï¼‰
```

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u fire-management -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8080

# æ£€æŸ¥é…ç½®æ–‡ä»¶
java -jar fire-management-system-1.0.0.jar --spring.config.location=application.yml
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•è¿æ¥
mysql -h localhost -u fire_user -p fire_management

# æ£€æŸ¥ MySQL çŠ¶æ€
sudo systemctl status mysql

# æŸ¥çœ‹ MySQL æ—¥å¿—
sudo tail -f /var/log/mysql/error.log
```

### å‰ç«¯æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æµ‹è¯•é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·æä¾›ï¼š

1. é”™è¯¯æ—¥å¿—ï¼ˆåº”ç”¨æ—¥å¿—ã€Nginx æ—¥å¿—ï¼‰
2. ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ï¼ˆOSã€Java ç‰ˆæœ¬ã€MySQL ç‰ˆæœ¬ï¼‰
3. é…ç½®æ–‡ä»¶ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
4. é—®é¢˜å¤ç°æ­¥éª¤

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `backend/SECURITY.md` - å®‰å…¨é…ç½®è¯¦ç»†è¯´æ˜
- `backend/PERFORMANCE.md` - æ€§èƒ½ä¼˜åŒ–å»ºè®®
- `backend/DATABASE.md` - æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- `å¼€å‘æŒ‡å—.md` - å¼€å‘ç¯å¢ƒé…ç½®
