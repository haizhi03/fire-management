# 实施计划

- [x] 1. 搭建项目基础架构



  - 创建Spring Boot后端项目，配置Maven依赖（Spring Web, Spring Security, MyBatis-Plus, MySQL驱动, Redis）
  - 创建Vue 3前端项目（Web管理端），配置Vite和Element Plus
  - 创建Vue 3移动端项目，配置Vant UI和Capacitor
  - 配置数据库连接和Redis连接
  - 设置项目目录结构（controller, service, mapper, entity, dto, vo）
  - _需求：所有需求的基础_

- [x] 2. 实现数据库表结构



  - 创建数据库初始化SQL脚本
  - 实现用户表（sys_user）和角色表（sys_role）
  - 实现消防设施表（fire_facility）和照片表（fire_facility_photo）
  - 实现审核记录表（audit_record）和操作日志表（operation_log）
  - 创建必要的索引（位置索引、状态索引、时间索引）
  - _需求：1.1, 2.1, 4.1_

- [x] 3. 实现用户认证与权限管理



- [x] 3.1 实现JWT认证机制


  - 创建JWT工具类，实现令牌生成和验证
  - 实现Spring Security配置，集成JWT过滤器
  - 创建登录接口，验证用户凭证并返回令牌
  - _需求：1.1, 1.2_

- [ ]* 3.2 编写属性测试：登录令牌有效性
  - **属性 1：登录令牌有效性**
  - **验证需求：1.1**

- [ ]* 3.3 编写属性测试：无效凭证拒绝
  - **属性 2：无效凭证拒绝**
  - **验证需求：1.2**

- [x] 3.4 实现权限控制


  - 创建权限注解和拦截器
  - 实现基于角色的访问控制（RBAC）
  - 创建用户管理接口（创建、编辑、删除用户）
  - _需求：1.4, 1.5_

- [ ]* 3.5 编写属性测试：用户创建完整性
  - **属性 3：用户创建完整性**
  - **验证需求：1.4**

- [ ]* 3.6 编写属性测试：权限访问控制
  - **属性 4：权限访问控制**
  - **验证需求：1.5**

- [x] 4. 实现消防设施管理核心功能



- [x] 4.1 实现设施CRUD接口


  - 创建设施实体类和Mapper
  - 实现设施列表查询（支持分页和筛选）
  - 实现设施详情查询
  - 实现设施创建和更新接口
  - 实现设施软删除接口
  - _需求：2.1, 2.2, 4.5_

- [ ]* 4.2 编写属性测试：必填字段验证
  - **属性 6：必填字段验证**
  - **验证需求：2.2**

- [ ]* 4.3 编写属性测试：软删除实现
  - **属性 18：软删除实现**
  - **验证需求：4.5**

- [x] 4.2 实现空间查询功能


  - 实现Haversine距离计算工具类
  - 实现周边设施查询接口（基于经纬度和半径）
  - 优化查询性能（使用位置索引）
  - _需求：3.3_

- [ ]* 4.4 编写属性测试：空间范围查询
  - **属性 11：空间范围查询**
  - **验证需求：3.3**

- [x] 4.5 实现设施详情接口

  - 实现设施详情查询，包含照片列表
  - 实现照片关联查询
  - _需求：3.2, 9.3_

- [ ]* 4.6 编写属性测试：设施详情完整性
  - **属性 10：设施详情完整性**
  - **验证需求：3.2**

- [ ]* 4.7 编写属性测试：照片关联查询
  - **属性 35：照片关联查询**
  - **验证需求：9.3**

- [x] 5. 实现数据采集功能


- [x] 5.1 实现照片上传功能


  - 创建文件上传工具类
  - 实现照片压缩功能（压缩到1080P）
  - 实现照片上传接口，返回文件URL
  - 实现上传失败重试机制
  - _需求：9.1, 9.2, 9.4_

- [ ]* 5.2 编写属性测试：照片压缩处理
  - **属性 33：照片压缩处理**
  - **验证需求：9.1**

- [ ]* 5.3 编写属性测试：文件存储成功
  - **属性 34：文件存储成功**
  - **验证需求：9.2**

- [x] 5.4 实现数据采集接口

  - 创建设施采集接口，接收位置、照片、属性信息
  - 实现GPS位置自动关联
  - 实现数据验证（必填字段检查）
  - 设置默认审核状态为待审核
  - _需求：2.1, 2.2, 2.5_

- [ ]* 5.5 编写属性测试：GPS位置关联
  - **属性 5：GPS位置关联**
  - **验证需求：2.1**

- [ ]* 5.6 编写属性测试：待审核状态标记
  - **属性 9：待审核状态标记**
  - **验证需求：2.5**

- [x] 6. 实现数据审核功能



- [x] 6.1 实现审核管理接口

  - 创建待审核列表查询接口（只返回audit_status=0的数据）
  - 实现审核通过接口，更新状态为已通过
  - 实现审核驳回接口，要求填写驳回原因
  - 创建审核记录，记录审核人和审核时间
  - _需求：4.1, 4.2, 4.3_

- [ ]* 6.2 编写属性测试：待审核数据过滤
  - **属性 14：待审核数据过滤**
  - **验证需求：4.1**

- [ ]* 6.3 编写属性测试：审核状态更新
  - **属性 15：审核状态更新**
  - **验证需求：4.2**

- [ ]* 6.4 编写属性测试：驳回原因必填
  - **属性 16：驳回原因必填**
  - **验证需求：4.3**

- [x] 6.5 实现操作日志记录

  - 创建操作日志切面（AOP）
  - 记录所有关键操作（登录、数据修改、审核等）
  - 实现日志查询接口
  - _需求：4.4, 10.3_

- [ ]* 6.6 编写属性测试：修改历史记录
  - **属性 17：修改历史记录**
  - **验证需求：4.4**

- [ ]* 6.7 编写属性测试：错误日志记录
  - **属性 38：错误日志记录**
  - **验证需求：10.3**

- [x] 7. 实现数据去重功能


- [x] 7.1 实现空间去重算法


  - 创建去重服务类
  - 实现Haversine距离计算
  - 实现重复数据检测（距离<10米）
  - 实现数据合并逻辑（保留信息最完整的记录）
  - 标记被合并的记录（is_merged=1）
  - 记录合并操作日志
  - _需求：5.1, 5.2, 5.3, 5.5_

- [ ]* 7.2 编写属性测试：空间去重判定
  - **属性 19：空间去重判定**
  - **验证需求：5.1**

- [ ]* 7.3 编写属性测试：去重记录保留
  - **属性 20：去重记录保留**
  - **验证需求：5.2, 5.3**

- [ ]* 7.4 编写属性测试：合并操作日志
  - **属性 21：合并操作日志**
  - **验证需求：5.5**

- [x] 8. 实现统计分析功能



- [x] 8.1 实现看板数据接口

  - 创建统计服务类
  - 实现设施总数统计
  - 实现区域分布统计
  - 实现状态比例统计
  - 实现采集趋势统计（支持时间范围过滤）
  - _需求：6.1, 6.3_

- [ ]* 8.2 编写属性测试：看板数据完整性
  - **属性 22：看板数据完整性**
  - **验证需求：6.1**

- [ ]* 8.3 编写属性测试：时间范围过滤
  - **属性 24：时间范围过滤**
  - **验证需求：6.3**

- [x] 8.4 实现热力图数据生成

  - 实现区域设施密度计算
  - 创建热力图数据接口
  - _需求：6.2_

- [ ]* 8.5 编写属性测试：热力图数据计算
  - **属性 23：热力图数据计算**
  - **验证需求：6.2**

- [x] 8.6 实现数据导出功能

  - 集成Apache POI库
  - 实现Excel报表生成
  - 创建数据导出接口
  - _需求：6.4_

- [ ]* 8.7 编写属性测试：Excel导出格式
  - **属性 25：Excel导出格式**
  - **验证需求：6.4**

- [x] 9. 实现Web管理端前端



- [x] 9.1 实现登录页面


  - 创建登录表单组件
  - 实现登录逻辑和令牌存储
  - 实现路由守卫（权限验证）
  - _需求：1.1, 1.2_

- [x] 9.2 实现设施管理页面


  - 创建设施列表页面（表格展示，支持分页和筛选）
  - 创建设施详情页面（显示照片、属性信息）
  - 创建设施编辑表单
  - _需求：3.2, 4.1_

- [x] 9.3 实现数据审核页面

  - 创建待审核列表页面
  - 创建审核详情页面（显示照片和位置）
  - 实现审核通过和驳回功能
  - _需求：4.1, 4.2, 4.3_

- [x] 9.4 实现统计看板页面

  - 创建看板布局
  - 集成ECharts图表库
  - 实现关键指标卡片
  - 实现热力图展示
  - 实现采集趋势图
  - _需求：6.1, 6.2, 6.3_

- [x] 9.5 实现用户管理页面

  - 创建用户列表页面
  - 创建用户编辑表单
  - 实现角色分配功能
  - _需求：1.4_

- [ ] 10. 实现移动端前端
- [ ] 10.1 实现移动端登录页面



  - 创建移动端登录表单
  - 实现令牌存储（localStorage）
  - 配置路由守卫
  - _需求：1.1_

- [x] 10.2 实现地图页面


  - 集成Leaflet或Mapbox GL地图库
  - 实现地图初始化和定位
  - 实现设施标注（根据状态显示不同颜色）
  - 实现信息窗口弹出
  - 实现周边查询功能
  - _需求：3.1, 3.3, 8.3, 8.4_

- [ ]* 10.3 编写属性测试：状态颜色映射
  - **属性 31：状态颜色映射**
  - **验证需求：8.3**

- [ ]* 10.4 编写属性测试：信息窗口触发
  - **属性 32：信息窗口触发**
  - **验证需求：8.4**

- [ ] 10.5 实现设施详情页面
  - 创建详情页面布局
  - 实现照片轮播展示
  - 实现导航功能（调用系统地图）
  - _需求：3.2, 3.5_

- [ ]* 10.6 编写属性测试：路径规划有效性
  - **属性 13：路径规划有效性**
  - **验证需求：3.5**

- [ ] 10.7 实现数据采集页面
  - 创建采集表单
  - 实现拍照功能（调用相机API）
  - 实现GPS定位获取
  - 实现表单验证
  - 实现数据提交
  - _需求：2.1, 2.2_

- [ ] 11. 实现离线功能
- [ ] 11.1 实现网络状态检测
  - 创建网络监听服务
  - 实现离线模式切换
  - 显示离线状态提示
  - _需求：7.1_

- [ ]* 11.2 编写属性测试：离线模式切换
  - **属性 26：离线模式切换**
  - **验证需求：7.1**

- [ ] 11.3 实现本地数据存储
  - 配置SQLite数据库（使用Capacitor Storage插件）
  - 创建本地数据表结构
  - 实现离线数据保存
  - 实现离线查询
  - _需求：2.3, 3.4, 7.2_

- [ ]* 11.4 编写属性测试：离线数据本地存储
  - **属性 7：离线数据本地存储**
  - **验证需求：2.3**

- [ ]* 11.5 编写属性测试：离线查询缓存
  - **属性 12：离线查询缓存**
  - **验证需求：3.4**

- [ ]* 11.6 编写属性测试：离线操作记录
  - **属性 27：离线操作记录**
  - **验证需求：7.2**

- [ ] 11.7 实现数据同步功能
  - 创建同步服务
  - 实现网络恢复检测和自动同步
  - 实现增量数据上传（只上传sync_status=0的记录）
  - 实现断点续传
  - 更新本地数据同步状态
  - _需求：2.4, 7.3, 7.4, 7.5_

- [ ]* 11.8 编写属性测试：自动数据同步
  - **属性 8：自动数据同步**
  - **验证需求：2.4**

- [ ]* 11.9 编写属性测试：自动同步触发
  - **属性 28：自动同步触发**
  - **验证需求：7.3**

- [ ]* 11.10 编写属性测试：增量数据同步
  - **属性 29：增量数据同步**
  - **验证需求：7.4**

- [ ]* 11.11 编写属性测试：断点续传支持
  - **属性 30：断点续传支持**
  - **验证需求：7.5**

- [x] 12. 实现级联删除功能

- [x] 12.1 实现照片级联删除


  - 在设施删除时，同时删除关联的照片记录
  - 删除文件系统中的照片文件
  - _需求：9.5_

- [ ]* 12.2 编写属性测试：级联删除照片
  - **属性 37：级联删除照片**

  - **验证需求：9.5**

- [ ] 13. 配置和优化


- [x] 13.1 配置Redis缓存



  - 配置Redis连接
  - 实现热点数据缓存（设施列表、看板数据）
  - 设置缓存过期策略
  - _需求：10.1_

- [x] 13.2 实现全局异常处理





  - 创建全局异常处理器
  - 定义统一错误响应格式
  - 实现特定场景错误处理
  - _需求：10.3_



- [ ] 13.3 配置HTTPS和安全策略
  - 配置SSL证书
  - 实现CORS跨域配置


  - 配置XSS和SQL注入防护
  - _需求：安全需求_



- [-] 13.4 性能优化

  - 优化数据库查询（添加索引）
  - 实现分页查询
  - 优化图片加载（懒加载）
  - _需求：10.1, 10.2_

- [ ] 14. 实现智能距离查询功能
- [x] 14.1 实现增强的距离查询后端接口



  - 创建增强周边查询接口，支持距离圈和单位转换
  - 实现最近设施查询接口
  - 实现距离范围筛选接口
  - 优化距离计算性能（边界框预筛选）
  - _需求：10.1, 10.2, 10.3, 10.4, 10.7_

- [ ]* 14.2 编写属性测试：距离圈可视化准确性
  - **属性 39：距离圈可视化准确性**
  - **验证需求：10.1**

- [ ]* 14.3 编写属性测试：距离单位转换正确性
  - **属性 40：距离单位转换正确性**
  - **验证需求：10.2**

- [ ]* 14.4 编写属性测试：实时距离计算准确性
  - **属性 41：实时距离计算准确性**
  - **验证需求：10.3**

- [ ]* 14.5 编写属性测试：距离范围筛选完整性
  - **属性 42：距离范围筛选完整性**
  - **验证需求：10.4**

- [ ]* 14.6 编写属性测试：最近设施查询准确性
  - **属性 44：最近设施查询准确性**
  - **验证需求：10.7**

- [ ] 14.7 实现路径规划和导航功能
  - 集成第三方地图API（高德/百度）
  - 实现多模式路径规划接口
  - 创建导航启动和跟踪接口
  - _需求：10.5, 10.6_

- [ ]* 14.8 编写属性测试：多模式路径规划可用性
  - **属性 43：多模式路径规划可用性**
  - **验证需求：10.5**

- [ ] 14.9 实现紧急模式查询
  - 创建紧急模式查询接口
  - 实现状态筛选和距离排序逻辑
  - _需求：10.8_

- [ ]* 14.10 编写属性测试：紧急模式设施筛选
  - **属性 45：紧急模式设施筛选**
  - **验证需求：10.8**

- [ ] 15. 实现前端智能距离查询界面
- [x] 15.1 增强地图页面距离查询功能




  - 实现可视化距离圈绘制
  - 添加距离单位切换控件
  - 实现距离范围筛选器
  - 添加实时距离显示
  - 实现最近设施高亮显示
  - _需求：10.1, 10.2, 10.3, 10.4, 10.7_

- [ ] 15.2 实现导航和路径规划界面
  - 添加路径规划选择器（步行/驾车/骑行）
  - 实现路径可视化显示
  - 添加导航启动按钮
  - 实现紧急模式切换
  - _需求：10.5, 10.6, 10.8_

- [ ] 15.3 优化移动端距离查询体验
  - 适配移动端距离查询界面
  - 实现手势操作（拖拽调整半径）
  - 添加语音导航支持
  - 优化触摸交互体验
  - _需求：10.1, 10.6_

- [ ] 16. 性能优化和缓存
- [ ] 16.1 实现距离查询缓存机制
  - 配置Redis缓存热点区域数据
  - 实现查询结果缓存策略
  - 添加缓存失效和更新机制
  - _需求：性能优化_

- [ ] 16.2 优化地理空间查询性能
  - 添加地理空间索引
  - 实现边界框预筛选
  - 优化大数据量查询性能
  - _需求：性能优化_

- [ ] 17. 最终检查点
  - 确保所有测试通过
  - 验证所有核心功能正常工作
  - 检查API文档完整性
  - 测试智能距离查询功能的用户体验
  - 如有问题请向用户咨询
